<Page
    x:Class="MusicPlayer.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MusicPlayer"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local1="using:MusicPlayer.Models"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
    Loaded="Page_Loaded">
    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="ButtonStyle.xaml"/>
                <ResourceDictionary Source="AppBarButtonStyle.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        
        <local1:ProgressConvert x:Key="progressConvert"/>
        <Storyboard x:Name="main_storyBoard" Completed="main_storyBoard_Completed">
            <DoubleAnimationUsingKeyFrames EnableDependentAnimation="True"
                                           Storyboard.TargetName="main_progressbar"
                                           Storyboard.TargetProperty="(RangeBase.Value)">
                <DiscreteDoubleKeyFrame KeyTime="0:0:1"
                                        Value="1"/>
                <DiscreteDoubleKeyFrame KeyTime="0:0:2"
                                        Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        <Storyboard x:Name="main_storyBoard2" Completed="main_storyBoard2_Completed">
            <DoubleAnimationUsingKeyFrames EnableDependentAnimation="True"
                                           Storyboard.TargetName="main_progressbar2"
                                           Storyboard.TargetProperty="(RangeBase.Value)">
                <DiscreteDoubleKeyFrame KeyTime="0:0:1"
                                        Value="0"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
        </ResourceDictionary>
    </Page.Resources>

    <Grid Name="main_grid">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="main_listview.Visibility" Value="Collapsed"/>
                        <!--<Setter Target="Title_textblock.Text" Value=""/>-->
                        <Setter Target="main_stackPanel.Visibility" Value="Collapsed"/>
                        <Setter Target="main_ellipse.Height" Value="200"/>
                        <Setter Target="main_ellipse.Width" Value="200"/>
                        <Setter Target="status_textblock.FontSize" Value="20"/>
                        <Setter Target="songTile_textblock.FontSize" Value="15"/>
                        <Setter Target="main_ellipse.VerticalAlignment" Value="Top"/>
                        <Setter Target="BackIcon_textblock.VerticalAlignment" Value="Top"/>
                        <Setter Target="ForwardIcon_textblock.VerticalAlignment" Value="Top"/>
                        <Setter Target="BackIcon_textblock.Margin" Value="5,60,0,0"/>
                        <Setter Target="ForwardIcon_textblock.Margin" Value="0,60,5,0"/>
                    </VisualState.Setters>
                </VisualState>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="700"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="main_ellipse.Height" Value="200"/>
                        <Setter Target="main_ellipse.Width" Value="200"/>
                        <Setter Target="status_textblock.FontSize" Value="20"/>
                        <Setter Target="songTile_textblock.FontSize" Value="15"/>
                    </VisualState.Setters>
                </VisualState>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="800"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <ProgressRing Name="main_progressRing"
                      Height="50"
                      Width="50"
                      Grid.Row="2"
                      Grid.RowSpan="4"
                      Visibility="Visible"
                      VerticalAlignment="Center"
                      HorizontalAlignment="Center"/>
        <StackPanel Name="main_stackPanel"
                    Orientation="Horizontal"
                    Margin="10,30,0,0">
            <TextBlock Name="Title_textblock"
                   FontSize="20"
                   Text="本地音乐"
                       VerticalAlignment="Center"
                   Visibility="Visible"/>
            <Button Name="model_button"
                    Content="播放模式"
                    Height="40"
                    Width="70"
                    FontSize="13"
                    Style="{StaticResource TransparentPathIconButtonStyle}"
                    BorderThickness="0"
                    Background="SkyBlue"
                    Foreground="Black"
                    Margin="70,0,0,0"
                    >
                <Button.Flyout>
                    <MenuFlyout x:Name="model_flyout">
                        <MenuFlyoutItem Name="item_1" 
                                        Text="单曲循环"
                                        Click="item_1_Click"/>
                        <MenuFlyoutItem Name="item_2"
                                        Text="顺序播放"
                                        Click="item_2_Click"/>
                        <MenuFlyoutItem Name="item_3"
                                        Text="随机播放"
                                        Click="item_3_Click"/>
                        <MenuFlyoutItem Name="item_4"
                                        Text="None"
                                        Click="item_4_Click"/>
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
        </StackPanel>
        <ListView Name="main_listview"
                  SelectionMode="Single"
                  Grid.Row="1"                 
                  Grid.RowSpan="4"
                  IsItemClickEnabled="True"
                  Background="White"
                  Opacity="0.7"
                  ItemsSource="{x:Bind use_music}"
                  ItemClick="main_listview_ItemClick">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="local1:Music">
                    <StackPanel Orientation="Horizontal">
                        <Image Name="iamge_Image"
                               Height="20"
                               Width="20"
                               Margin="0,0,10,0"
                               Source="{x:Bind Cover}"/>
                        <TextBlock Name="title_textblock"
                                   FontSize="13"
                                   VerticalAlignment="Center"
                                   FontWeight="Bold"
                                   Text="{x:Bind Title}"/>
                        <TextBlock Text=" - "
                                   VerticalAlignment="Center"
                                   FontFamily="13"/>
                        <TextBlock Name="artist_textblock"
                                   FontSize="13"
                                   VerticalAlignment="Center"
                                   Text="{x:Bind Artist}"/>
                    </StackPanel>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <TextBlock Name="status_textblock"
                   FontSize="30"
                   Margin="0,30,0,0"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Grid.Column="1"/>

        <Grid Name="ellipse_Grid"
                    Grid.Row="1"
                    Grid.Column="1"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Stretch">



            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Name="BackIcon_textblock"
                    FontFamily="Segoe MDL2 Assets"
                    Text="&#xE76B;"
                       Foreground="AliceBlue"
                    FontSize="50"
                       Margin="10,0,0,0"
                       VerticalAlignment="Center"
                       Tapped="BackIcon_textblock_Tapped"/>
            <Ellipse Name="main_ellipse"
                     Height="300"
                     Width="300" 
                     Grid.Column="1"
                     RenderTransformOrigin="0.5,0.5">
                <Ellipse.RenderTransform>
                    <CompositeTransform/>
                </Ellipse.RenderTransform>
                <Ellipse.Resources>
                    <Storyboard x:Name="story_board"
                                RepeatBehavior="Forever">
                        <DoubleAnimation Duration="0:0:50"
                                         To="360"
                                         Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.Rotation)"
                                         Storyboard.TargetName="main_ellipse"
                                         d:IsOptimized="True"/>
                    </Storyboard>
                </Ellipse.Resources>
                <Ellipse.Fill>
                    <ImageBrush ImageSource="Assets/girl.jpg"/>
                </Ellipse.Fill>
            </Ellipse>
            <TextBlock Name="ForwardIcon_textblock"
                    FontFamily="Segoe MDL2 Assets"
                    Text="&#xE76C;"
                    FontSize="50"
                       Foreground="AliceBlue"
                       Grid.Column="2"
                       Margin="0,0,10,0"
                       VerticalAlignment="Center"
                       Tapped="ForwardIcon_textblock_Tapped"/>

        </Grid>

        <MediaElement Name="main_mediaElement"                         
                          AutoPlay="False"/>
        <TextBlock Name="songTile_textblock"
                      Grid.Row="2"
                       Grid.Column="1"
                   FontSize="20"
                   Foreground="Black"
                   Margin="0,0,0,10"
                       HorizontalAlignment="Center"/>
        <Grid Grid.Row="3"
              Grid.Column="1"
              Margin="50,0,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Slider Name="main_slider"
                    Minimum="0"
                    StepFrequency="1"
                    Foreground="SkyBlue"
                    Background="Gray"
                    Value="{Binding ElementName=main_mediaElement, Path=Position, Converter={StaticResource progressConvert }, Mode=TwoWay}"
                    ValueChanged="main_slider_ValueChanged"/>
            <TextBlock Name="playTime_textblock"
                       Grid.Column="1"
                       FontSize="15"
                       Margin="7,0,0,10"
                       Width="90"                      
                       VerticalAlignment="Center"/>
        </Grid>
        <Button Name="setting_button"
                Grid.Row="4"
                Grid.Column="1"
                FontFamily="Segoe MDL2 Assets"
                Content="&#xE890;"
                Background="Transparent"
                FontSize="30"
                BorderThickness="0"
                Opacity="0.1"
                Style="{StaticResource TransparentPathIconButtonStyle}"
                HorizontalAlignment="Center"
                PointerEntered="setting_button_PointerEntered"
                PointerExited="setting_button_PointerExited"
                Click="setting_button_Click"/>
        <ProgressBar Name="main_progressbar"
                     Grid.Row="3"
                     Grid.Column="1"
                     Visibility="Collapsed"/>
        <ProgressBar Name="main_progressbar2"
                     Grid.Row="3"
                     Grid.Column="1"
                     Visibility="Collapsed"/>
        <!--<TextBlock Name="lyrics_textblock"
                   Grid.Row="1"
                   Grid.RowSpan="3"
                   Grid.Column="2"
                   Text="歌词部分"
                   FontSize="40"
                   HorizontalAlignment="Center"/>-->
    </Grid>
    <Page.BottomAppBar>
        
        <CommandBar Background="White"
                    FontWeight="Bold"
                    Name="main_commanBar">
            <AppBarButton Name="back_button"
                          Icon="Previous"
                          Label="上一首"
                          Click="back_button_Click"/>
            <AppBarButton Name="play_button"
                          Icon="Play"
                          Label="播放"
                          Click="play_button_Click"/>
            <AppBarButton Name="forward_button"
                          Icon="Next"
                          Label="下一首"
                          Click="forward_button_Click"/>
            <!--<AppBarButton Name="pause_button"
                          Icon="Pause"
                          Label="暂停"
                          Click="pause_button_Click"/>-->
            <AppBarButton Name="stop_button"
                          Icon="Stop"
                          Label="停止"
                          Click="stop_button_Click"/>
            <AppBarButton Name="add_button"
                          Icon="OpenFile"
                          Label="添加文件"
                          Click="add_button_Click"/>
            <AppBarButton Name="volume"
                          Icon="Volume"
                          Label="音量"
                          Click="volume_Click">
                <AppBarButton.Flyout>
                    <Flyout x:Name="volume_flyout">
                        <StackPanel Name="volume_stackPanel"
                                    Orientation="Horizontal"
                                    Height="30"
                                    Width="260">
                            <TextBlock Name="volumeIcon_textblock"
                                       FontFamily="Segoe MDL2 Assets"
                                       Text="&#xE994;"
                                       FontSize="30"
                                       Margin="0,4,0,0"
                                       Tapped="volumeIcon_textblock_Tapped"/>
                            <Slider Name="volume_slider"
                                    Maximum="100"
                                    Minimum="0"
                                    Margin="10,0,0,0"
                                    Height="30"
                                    Width="150"
                                    ValueChanged="volume_slider_ValueChanged"/>
                            <TextBlock Name="volume_textblock"
                                       FontSize="30"
                                       Margin="10,4,0,0"
                                       Text="30"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                            
                            
                       
                    </Flyout>
                </AppBarButton.Flyout>
            </AppBarButton>
            <AppBarButton Name="display_button"
                          Icon="FullScreen"
                          Label="全屏"
                          Click="display_button_Click"/>
            <AppBarButton Name="settign"
                          Icon="Setting"
                          Label="设置"
                          Click="settign_Click">
                <AppBarButton.Flyout>
                    <MenuFlyout x:Name="menu_flyout">
                        <MenuFlyoutItem Name="background_menu"
                                    Text="自定义背景图片(.jpg)"
                                    Click="background_menu_Click"
                                        FontStyle="Oblique"/>
                        <MenuFlyoutSubItem Text="专辑封面是否转动"
                                           FontStyle="Oblique">
                            <MenuFlyoutItem Name="Yes_item"
                                            Text="是"
                                            FontStyle="Oblique"
                                            Click="Yes_item_Click"/>
                            <MenuFlyoutItem Name="No_item"
                                            Text="否"
                                            FontStyle="Oblique"
                                            Click="No_item_Click"/>
                        </MenuFlyoutSubItem>
                        <MenuFlyoutItem Name="hidden_menu"
                                        Text="隐藏底栏"
                                        FontStyle="Oblique"
                                        Click="hidden_menu_Click"/>
                        <MenuFlyoutItem Name="about_menu"
                                        Text="关于软件"
                                        FontStyle="Oblique"
                                        Click="about_menu_Click"/>

                    </MenuFlyout>
                </AppBarButton.Flyout>
            </AppBarButton>
        </CommandBar>
    </Page.BottomAppBar>
</Page>
